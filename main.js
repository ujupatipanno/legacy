var m=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var b=Object.prototype.hasOwnProperty;var P=(l,e)=>{for(var t in e)m(l,t,{get:e[t],enumerable:!0})},L=(l,e,t,i)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of _(e))!b.call(l,n)&&n!==t&&m(l,n,{get:()=>e[n],enumerable:!(i=f(e,n))||i.enumerable});return l};var T=l=>L(m({},"__esModule",{value:!0}),l);var N={};P(N,{default:()=>h});module.exports=T(N);var a=require("obsidian"),D={legacyFolder:"legacy",sortOrder:"asc"},h=class extends a.Plugin{async onload(){await this.loadSettings(),this.addCommand({id:"create-legacy-file",name:"\uD604\uC7AC \uBB38\uC11C\uC758 \uB808\uAC70\uC2DC \uD30C\uC77C \uB9CC\uB4E4\uAE30",icon:"lucide-save",callback:()=>this.createLegacyFile()}),this.addCommand({id:"preserve-legacy-files",name:"\uD604\uC7AC \uBB38\uC11C\uC758 \uB808\uAC70\uC2DC \uD30C\uC77C \uBCF4\uC874\uD558\uAE30",icon:"lucide-save-all",callback:()=>this.preserveLegacyFiles()}),this.addRibbonIcon("lucide-save","\uB808\uAC70\uC2DC \uD30C\uC77C \uB9CC\uB4E4\uAE30",()=>{this.createLegacyFile()}),this.addRibbonIcon("lucide-save-all","\uB808\uAC70\uC2DC \uD30C\uC77C \uBCF4\uC874\uD558\uAE30",()=>{this.preserveLegacyFiles()}),this.addSettingTab(new u(this.app,this))}onunload(){}async loadSettings(){this.settings=Object.assign({},D,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}getTimestamp(){let e=new Date,t=e.getFullYear(),i=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0"),g=String(e.getHours()).padStart(2,"0"),c=String(e.getMinutes()).padStart(2,"0"),r=String(e.getSeconds()).padStart(2,"0");return`${t}${i}${n}${g}${c}${r}`}async createLegacyFile(){let e=this.app.workspace.getActiveFile();if(!e){new a.Notice("\uD65C\uC131\uD654\uB41C \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}try{let t=await this.app.vault.read(e),i=e.basename,n=this.getTimestamp(),g=`${i}_legacy_${n}.md`,c=(0,a.normalizePath)(this.settings.legacyFolder);await this.app.vault.adapter.exists(c)||await this.app.vault.createFolder(c);let r=(0,a.normalizePath)(`${c}/${g}`);await this.app.vault.create(r,t),new a.Notice(`\uB808\uAC70\uC2DC \uD30C\uC77C\uC774 \uC0DD\uC131\uB418\uC5C8\uC2B5\uB2C8\uB2E4: ${g}`)}catch(t){console.error("\uB808\uAC70\uC2DC \uD30C\uC77C \uC0DD\uC131 \uC911 \uC624\uB958:",t),new a.Notice("\uB808\uAC70\uC2DC \uD30C\uC77C \uC0DD\uC131\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.")}}async preserveLegacyFiles(){let e=this.app.workspace.getActiveFile();if(!e){new a.Notice("\uD65C\uC131\uD654\uB41C \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}try{let t=e.basename,i=(0,a.normalizePath)(this.settings.legacyFolder);if(!await this.app.vault.adapter.exists(i)){new a.Notice("\uB808\uAC70\uC2DC \uD3F4\uB354\uAC00 \uC874\uC7AC\uD558\uC9C0 \uC54A\uC2B5\uB2C8\uB2E4.");return}let g=this.app.vault.getFiles().filter(s=>{let p=(s.parent?(0,a.normalizePath)(s.parent.path):"")===i,$=new RegExp(`^${t}_legacy_\\d{14}$`).test(s.basename);return p&&$});if(g.length===0){new a.Notice("\uB808\uAC70\uC2DC \uD30C\uC77C\uC774 \uC5C6\uC2B5\uB2C8\uB2E4.");return}let c=g.map(s=>{let o=s.basename.match(/_legacy_(\d{14})$/),p=o?o[1]:"00000000000000";return{file:s,timestamp:p}});c.sort((s,o)=>this.settings.sortOrder==="asc"?s.timestamp.localeCompare(o.timestamp):o.timestamp.localeCompare(s.timestamp));let r="",d=[];for(let s=0;s<c.length;s++){let{file:o,timestamp:p}=c[s],F=await this.app.vault.read(o);d.push(p),s>0&&(r+=`
___

`),r+=`# ${t}_legacy_${p}

`,r+=F}let w=d[0],v=d[d.length-1],y=`${t}_legacy_${w}-${v}.md`,S=(0,a.normalizePath)(`${i}/${y}`);await this.app.vault.create(S,r);for(let{file:s}of c)await this.app.vault.delete(s);new a.Notice(`\uB808\uAC70\uC2DC \uD30C\uC77C\uC774 \uBCF4\uC874\uB418\uC5C8\uC2B5\uB2C8\uB2E4: ${y}`)}catch(t){console.error("\uB808\uAC70\uC2DC \uD30C\uC77C \uBCF4\uC874 \uC911 \uC624\uB958:",t),new a.Notice("\uB808\uAC70\uC2DC \uD30C\uC77C \uBCF4\uC874\uC5D0 \uC2E4\uD328\uD588\uC2B5\uB2C8\uB2E4.")}}},u=class extends a.PluginSettingTab{constructor(e,t){super(e,t),this.plugin=t}display(){let{containerEl:e}=this;e.empty(),new a.Setting(e).setName("\uB808\uAC70\uC2DC \uD3F4\uB354 \uC704\uCE58").setDesc("\uB808\uAC70\uC2DC \uD30C\uC77C\uC774 \uC800\uC7A5\uB420 \uD3F4\uB354 \uACBD\uB85C\uB97C \uC9C0\uC815\uD558\uC138\uC694.").addText(t=>t.setPlaceholder("legacy").setValue(this.plugin.settings.legacyFolder).onChange(async i=>{this.plugin.settings.legacyFolder=i||"legacy",await this.plugin.saveSettings()})),new a.Setting(e).setName("\uC815\uB82C \uC21C\uC11C").setDesc("\uB808\uAC70\uC2DC \uD30C\uC77C\uC744 \uBCF4\uC874\uD560 \uB54C \uC815\uB82C \uC21C\uC11C\uB97C \uC120\uD0DD\uD558\uC138\uC694.").addDropdown(t=>t.addOption("asc","\uC624\uB984\uCC28\uC21C (\uC624\uB798\uB41C \uAC83\uBD80\uD130)").addOption("desc","\uB0B4\uB9BC\uCC28\uC21C (\uCD5C\uC2E0 \uAC83\uBD80\uD130)").setValue(this.plugin.settings.sortOrder).onChange(async i=>{this.plugin.settings.sortOrder=i,await this.plugin.saveSettings()}))}};
